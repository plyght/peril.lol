let currentPhoto=null,allPhotos=[],currentView='albums',currentFolder=null;function openLightbox(p){currentPhoto=p;const l=document.getElementById('lightbox'),i=document.getElementById('lightbox-img'),info=document.getElementById('lightbox-info');i.src=p.filename;i.alt=p.title;info.innerHTML=generateLightboxInfoHTML(p);l.classList.add('active')}function closeLightbox(){document.getElementById('lightbox').classList.remove('active')}function viewFullResolution(){if(currentPhoto)window.open(currentPhoto.filename,'_blank')}function getRandomPhoto(photos){return photos[Math.floor(Math.random()*photos.length)]}function renderAlbumCards(photos){const container=document.getElementById('album-cards'),folders=getFolders(photos);container.innerHTML='';folders.forEach(f=>{const folderPhotos=filterPhotosByFolder(photos,f);if(folderPhotos.length===0)return;const randomPhoto=getRandomPhoto(folderPhotos);const card=document.createElement('div');card.className='album-card';card.onclick=()=>showAlbum(f);const bg=document.createElement('div');bg.className='album-card-bg';bg.style.backgroundImage=`url(${randomPhoto.filename})`;const overlay=document.createElement('div');overlay.className='album-card-overlay';const title=document.createElement('div');title.className='album-card-title';title.textContent=f;overlay.appendChild(title);card.appendChild(bg);card.appendChild(overlay);container.appendChild(card)})}function showAlbum(folder){currentView='gallery';currentFolder=folder;document.getElementById('album-cards').style.display='none';document.getElementById('gallery').style.display='block';document.querySelector('.back-link').style.display='none';document.querySelector('h1').innerHTML=`<a href="#" onclick="showAlbums()">‚Üê Photos</a> / ${folder.charAt(0).toUpperCase()+folder.slice(1)}`;renderGallery(allPhotos)}function showAlbums(){currentView='albums';currentFolder=null;document.getElementById('album-cards').style.display='grid';document.getElementById('gallery').style.display='none';document.querySelector('.back-link').style.display='block';document.querySelector('h1').textContent='Photos'}function renderGallery(photos){const g=document.getElementById('gallery'),filtered=filterPhotosByFolder(photos,currentFolder);g.innerHTML='';filtered.forEach(p=>{const c=document.createElement('div');c.style.position='relative';const i=document.createElement('img');i.src=p.filename;i.alt=p.title;i.loading='lazy';i.onclick=()=>openLightbox(p);c.appendChild(i);g.appendChild(c)})}document.addEventListener('keydown',e=>{if(e.key==='Escape')closeLightbox()});(async()=>{const container=document.getElementById('album-cards');showLoading(container);try{allPhotos=await fetchPhotos();renderAlbumCards(allPhotos)}catch{showError(container,'Error loading photos. Please try again.')}})()