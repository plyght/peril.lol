let currentPhoto=null,allPhotos=[],currentFolder='all';function openLightbox(p){currentPhoto=p;const l=document.getElementById('lightbox'),i=document.getElementById('lightbox-img'),info=document.getElementById('lightbox-info');i.src=p.filename;i.alt=p.title;info.innerHTML=generateLightboxInfoHTML(p);l.classList.add('active')}function closeLightbox(){document.getElementById('lightbox').classList.remove('active')}function viewFullResolution(){if(currentPhoto)window.open(currentPhoto.filename,'_blank')}function renderFolderNav(photos){const nav=document.getElementById('folder-nav'),folders=getFolders(photos);nav.innerHTML='';const allBtn=document.createElement('button');allBtn.textContent='All';allBtn.className=currentFolder==='all'?'active':'';allBtn.onclick=()=>switchFolder('all');nav.appendChild(allBtn);folders.forEach(f=>{const btn=document.createElement('button');btn.textContent=f.charAt(0).toUpperCase()+f.slice(1);btn.className=currentFolder===f?'active':'';btn.onclick=()=>switchFolder(f);nav.appendChild(btn)})}function switchFolder(folder){currentFolder=folder;renderFolderNav(allPhotos);renderGallery(allPhotos)}function renderGallery(photos){const g=document.getElementById('gallery'),filtered=currentFolder==='all'?photos:filterPhotosByFolder(photos,currentFolder);g.innerHTML='';filtered.forEach(p=>{const c=document.createElement('div');c.style.position='relative';const i=document.createElement('img');i.src=p.filename;i.alt=p.title;i.loading='lazy';i.onclick=()=>openLightbox(p);c.appendChild(i);g.appendChild(c)})}document.addEventListener('keydown',e=>{if(e.key==='Escape')closeLightbox()});(async()=>{const g=document.getElementById('gallery');showLoading(g);try{allPhotos=await fetchPhotos();renderFolderNav(allPhotos);renderGallery(allPhotos)}catch{showError(g,'Error loading photos. Please try again.')}})()